name: cd

on:
  push:
    branches: [main]

jobs:
    deploy:
        name: Deploy
        runs-on: ubuntu-latest

        steps:
          - name: Check out code
            uses: actions/checkout@v4

          - name: Set up Go
            uses: actions/setup-go@v5
            with:
              go-version: "1.25.1"

          - name: buildprod.sh
            run: |
              chmod +x ./scripts/buildprod.sh
              ./scripts/buildprod.sh
          - id: 'auth'
            uses: 'google-github-actions/auth@v2'
            with:
              credentials_json: '${{ secrets.GCP_CREDENTIALS }}'

          - name: 'Set up Cloud SDK'
            uses: 'google-github-actions/setup-gcloud@v3'
      
          - name: 'Use gcloud CLI'
            run: 'gcloud info'
        
          - name: gcloud
            run: |
              gcloud builds submit --tag us-central1-docker.pkg.dev/notely-474004/notely-ar-repo/notely:latest .


        #   - name: Log in to Docker Hub
        #     uses: docker/login-action@v2
        #     with:
        #       username: ${{ secrets.DOCKER_HUB_USERNAME }}
        #       password: ${{ secrets.DOCKER_HUB_ACCESS_TOKEN }}

        #   - name: Build and push Docker image
        #     uses: docker/build-push-action@v4
        #     with:
        #       context: .
        #       push: true
        #       tags: ${{ secrets.DOCKER_HUB_USERNAME }}/notely:latest
